<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Sample of websocket with golang</title>
		
		<script src="jquery.min.js"></script>
		<script>

var GGameId=0;
var GPlayerIndex=0;
var GRkey = Math.floor((Math.random() * 10000000) + 1) +  Math.floor((Math.random() * 10000000) + 1);


  var ws = 0;
        
function rc(cmd){
	
	alert(GGameId);
	
	 var cmdObj = {
    GameId:parseInt(GGameId),
    Cmd:cmd,
    Rkey:GRkey,
 
    timestamp: Date.now()
  };
  

     
         var data = cmd
         ws.send(JSON.stringify(cmdObj));
      
	
}//end rc



function remote_setup(){
	

 var params={};
   window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(str,key,value)
    {params[key] = value;});


	GGameId = params['gameid'];

	rkey = params['rkey'];
	if(rkey  == undefined ) {
		window.location = window.location+"&rkey="+GRkey;
		
	}
	else{
		GRkey = rkey;
		
	}
	
}


function join_game(){

    			$.ajax({
  type: "POST",
  url: "http://peeepong.host/rest/gamejoin?gameid="+GGameId+"&rkey="+GRkey,
  data: "koos=1",
   dataType: 'json',
  success:function(data){
	  if(data.Players[0].RKey==GRkey){
	  GPlayerIndex = 0;
	  }else if(data.Players[1].RKey==GRkey){
		GPlayerIndex = 1;
	  }
	  
	  $('#pstatus').text("Connected - Game ("+GGameId+")");
	  $('#pindex').text("Player ("+(GPlayerIndex+1)+")");
	  
  }//end succues
 
});//end ajax;

}








$(function() {
    console.log( "ready!" );
    remote_setup();
    
    
    ws =  new WebSocket("ws://127.0.0.1:8080/rest/cmd");
        ws.onmessage = function(e) {
          console.log("RX:" + event.data);
        }
  
});
		</script>
	</head>
	<body>

      
      
	<h1>PeePong - Control</h1>
	<a href="/index3.html">GAME LIST</a>
	
	<div id="pstatus" style="padding:20px;">
		NOT CONNECTED
	</div>
	
	
	
	<div id="pindex" style="padding:20px;">
		Player X
	</div>
	
	
	<div id="rcontrols" style="width:100%;">
		<table" border="1" style="padding:10px;margin:10px;">
			<tr>
				<td><input style="padding:10px;"  type="button" value="LEFT" onclick="rc(1);"></td>
				
				<td><input style="padding:10px;"  type="button" value="ACTION" onclick="rc(10);"></td>
				
				<td><input style="padding:10px;"  type="button" value="RIGHT" onclick="rc(2);"></td>
				
			</tr>
		</table>
	</div>
	<p>
	</p>
	<input type="button" value="Join Game" onclick="join_game();">
	
	
	
	</body>
</html>
